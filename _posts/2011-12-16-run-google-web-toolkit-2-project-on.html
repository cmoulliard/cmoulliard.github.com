---
layout: post
title: "Run a Google Web Toolkit 2 project on Apache Karaf/ServiceMix"
date: 2011-12-16
comments: true
categories:
- WAB
- Karaf
- GWT
- Pax-Web
- WAR
- Apache
- ServiceMix
tags: []
share: true
---

<div class='post'>
    To simplify the development of Web projects on Apache Karaf/Apache ServiceMix, we have created
    <a href="https://github.com/ops4j/org.ops4j.pax.web/tree/master/pax-web-archetypes" target="_blank">archetypes</a> to setup WAR or WAB projects. They are very basic but they can be enriched with framework like Struts 2, Wicket, plain JSP or MyFaces JSF as they are currently supported on Apache Karaf - ServiceMix.<br/><br/>For the
    <a href="http://code.google.com/webtoolkit/" target="_blank">GWT users</a>, it exists now an archetype which will create a GWT 2.4 project. To create such a project, you must generate a project from the archetype<br/><br/>
    <pre class="text" name="code">mvn archetype:generate \<br/>   -DarchetypeGroupId=org.ops4j.pax.web.archetypes\<br/>   -DarchetypeArtifactId=wab-gwt-archetype \<br/>   -DarchetypeVersion=<span style="background-color: white; color: #202020; font-family: arial, sans-serif; font-size: 13px; line-height: 18px; white-space: normal;">2.1.2</span> \<br/>   -DgroupId=com.mycompany \<br/>   -DartifactId=hello \<br/>   -Dversion=1.0<br/></pre>
    <pre class="text" name="code"></pre>
    <div class="separator" style="clear: both; text-align: center;">
        <a href="{{site.url}}/assets/images//archetype-creation.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="279" src="{{site.url}}/assets/images//archetype-creation.png" width="320"/></a>
    </div>
    <pre class="text" name="code"></pre>
    <br/>build next the WAB using hello/mvn clean install<br/><br/>and deploy it on Apache Karaf<br/><br/>

    <div class="separator" style="clear: both; text-align: center;">
        <a href="{{site.url}}/assets/images//karaf-gwt2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="181" src="{{site.url}}/assets/images//karaf-gwt2.png" width="320"/></a>
    </div>
    <br/><br/>Verify that the web site is well registered :<br/><br/>

    <div class="separator" style="clear: both; text-align: center;">
        <a href="{{site.url}}/assets/images//web-list.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="23" src="{{site.url}}/assets/images//web-list.png" width="320"/></a>
    </div>
    <br/><br/>Next, you can navigate to your application in your browser and click on the button to say Hello.<br/><br/>

    <div class="separator" style="clear: both; text-align: center;">
        <a href="{{site.url}}/assets/images//browser-gwt2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="225" src="{{site.url}}/assets/images//browser-gwt2.png" width="320"/></a>
    </div>
    <br/><br/><br/>Remark : A WAB project is nothing more than a WAR excepted it is packaged as a bundle file, that we have removed the WEB-INF/lib dependencies and create a MANIFEST file containing the OSGI instructions.<br/><br/><br/>
</div>
<h2>Comments</h2>
<div class='comments'>
    <div class='comment'>
        <div class='author'>Charles Moulliard</div>
        <div class='content'>
            Thx for your comment Lukasz Dywocki --&gt;<br/><br/>You don&#39;t need gwt-user at runtime because:<br/>- Java application written with GWT is compiled to Java Script<br/>- Java .class files are not needed at all to run it<br/>- Java Script do not depend on any Java classes<br/><br/>What you actually need is only to collect generated resources package them in jar with additional classifier and install it instead of compiled Java artifact. Below you might find example of maven-jar-plugin configuration which catches generated artifacts from GWT project and package it with -gwt classifier.<br/><br/>
            <br/> org.apache.maven.plugins<br/> maven-jar-plugin<br/> 2.3<br/> <br/> <br/> gwt<br/> <br/> jar<br/> <br/>
            <br/> ${basedir}/target/${pom.artifactId}-${pom.version}/Application<br/> gwt<br/> <br/> <br/> <br/></div>
    </div>
    <div class='comment'>
        <div class='author'>Charles Moulliard</div>
        <div class='content'>
            Thx for Lukasz Dywicki explanation --&gt;
            <br/><br/>You don&#39;t need gwt-user at runtime because:<br/>- Java application written with GWT is compiled to Java Script<br/>- Java .class files are not needed at all to run it<br/>- Java Script do not depend on any Java classes<br/><br/>What you actually need is only to collect generated resources package them in jar with additional classifier and install it instead of compiled Java artifact. Below you might find example of maven-jar-plugin configuration which catches generated artifacts from GWT project and package it with -gwt classifier.<br/><br/>
            <br/> org.apache.maven.plugins<br/> maven-jar-plugin<br/> 2.3<br/> <br/> <br/> gwt<br/> <br/> jar<br/> <br/>
            <br/> ${basedir}/target/${pom.artifactId}-${pom.version}/Application<br/> gwt<br/> <br/> <br/> <br/></div>
    </div>
    <div class='comment'>
        <div class='author'>cmoulliard</div>
        <div class='content'>
            Hi Thirlan,<br/><br/>As OPS4J project has released the gwt-archetype 2.1.2, you should use now this version by example now (http://repo1.maven.org/maven2/org/ops4j/pax/web/archetypes/wab-gwt-archetype/2.1.2/) instead of the SNAPSHOT<br/><br/>Regards,<br/><br/>Charles
        </div>
    </div>
    <div class='comment'>
        <div class='author'>Thirlan</div>
        <div class='content'>
            Is this still the suggested way to deploy a GWT product into servicemix? If so what is the repository I should access for the archetype? I keep getting the error message &quot;The desired archetype does not exist (org.ops4j.pax.web.archetypes:wab-gwt-archetype:2.0.0-SNAPSHOT)&quot; no matter which repo I point to.</div>
    </div>
    <div class='comment'>
        <div class='author'>Brent</div>
        <div class='content'>
            We are trying to use this kind of development here, but it is seemingly somewhat slow because with even a small javascript change, or JSP change, etc, I have to reinstall the bundle to the karaf container. I liked it better in Tomcat how I could try things out quite quickly and javascript changes were immediate, and tomcate would recompile JSP files when the file changes. We are trying a kind of hybrid of this where all of our web services, etc are deployed to the karaf container, and the UI components are deployed to tomcat, but I continually get cross site scripting errors when my javascript attempts to hit the webservices in the karaf container.
            <br/>Do you have any thoughts about how me and my team could develop quicker?
        </div>
    </div>
    <div class='comment'>
        <div class='author'>amasse</div>
        <div class='content'>
            I&#39;m trying to install the 2 gwt 2.4.0_1 bundles (release version now) and I have the following issue :<br/><br/><br/>org.osgi.framework.BundleException: Unable to resolve module org.apache.servicemix.bundles.gwt-user [229.0] because it exports package &#39;com.google.gwt.core.client&#39; and is also exposed to it from org.apache.servicemix.bundles.gwt-dev [235.0] via the following dependency chain:<br/><br/> org.apache.servicemix.bundles.gwt-user [229.0]<br/> import: (package=com.google.gwt.util.tools)<br/> |<br/> export: package=com.google.gwt.util.tools; uses:=com.google.gwt.core.client<br/> export: package=com.google.gwt.core.client<br/> org.apache.servicemix.bundles.gwt-dev [235.0]<br/><br/>Any idea ?<br/>Thanks
        </div>
    </div>
    <div class='comment'>
        <div class='author'>Charles Moulliard</div>
        <div class='content'>
            Apache Maven repo should be used to get the servicemix bundles as they are not yet published (https://repository.apache.org/content/repositories/snapshots/)</div>
    </div>
    <div class='comment'>
        <div class='author'>Christian</div>
        <div class='content'>
            Hi, thanks for this post. I just tried this. Building works fine, but when i try to follow the instructions in the README i get errors for:<br/><br/> install -s mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.json/20090211_1-SNAPSHOT<br/> install -s mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.gwt-dev/2.4.0_1-SNAPSHOT<br/> install -s mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.gwt-user/2.4.0_1-SNAPSHOT<br/><br/>java.lang.RuntimeException: URL [mvn:...] could not be resolved.<br/><br/>Do i have to add a certain maven repo?<br/><br/>Thanks
        </div>
    </div>
</div>
