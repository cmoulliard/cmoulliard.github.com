---
layout: post
title: "Trick to pass an uri declared in a property file to a Camel route"
date: 2009-05-05
comments: false
---

<div class='post'>
    Defining Camel uris in a file is not so easy. Until now, the only possibility was to create a camel endpoint where the uri was declared in the XML file.<br/><br/>Here is a trick who will simplify your life to declare/define the uri in a property file. Spring injection is used to replaced the variable declared in your XML file with the value discovered in the property file.<br/><br/>By example, to work with the following uri : file://d:/temp/data/?move=d:/temp/done/${file.name}<br/><br/>Remark : as you can see, the uri contains a variable to a Camel variable and in consequence is not a Spring bean. So we have to inform Spring that the variable to be searched in the XML file use another syntax delimiter (#{} instead of ${}).<br/><br/>Here is what you have to do<br/><br/><span style="font-weight: bold;">Step 1 : Create org.springframework.beans.factory.config.PropertyPlaceholderConfigurer bean</span><br/><br/>Define a PropertyPlaceHolder (using another prefix/suffix delimiter) to avoid conflict between your camel variable and Spring property<br/><br/>
    <pre name="code" class="xml"><br/>   <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <br/>
        <property name="placeholderPrefix" value="#{"> (1)<br/>
            <property name="placeholderSuffix" value="}"> (2)<br/>
                <property name="location" value="classpath:META-INF/spring/org.apache.camel.example.reportincident.routing.properties"> (2)<br/>
                </property>
                <br/></pre>
    <br/>(1) : Define a different prefix instead of ${ which is the value by default and used as variable<br />(2) : Define the value of the suffix. In this case, this is the same as the default value<br /><br /><span style="font-weight:bold;">Step 2 : Create org.apache.camel.example.reportincident.routing.properties</span><br /><br />Create the following file : org.apache.camel.example.reportincident.routing.properties and put it in your classpath. If you plan to deploy your camel route under Apache ServiceMix Kernel --> Apache Karaf, add this file in the META-INF/spring directory by example<br />Add the following property :<br /><br />uriFile=file://d:/temp/data/?move=d:/temp/done/${file.name}<br/><br/><span style="font-weight:bold;">Step 3 : Create an endpoint in your Camel Spring DSL file</span><br/><br/>Create a camel endpoint for the uri that you would like to use<br/><br/><br/>
    <pre name="code" class="xml"><br/><camel:endpoint id="fileEndpoint" uri="#{uriFile}"> (1)<br/></pre>
    <br/>(1) As you can see, we use as a Spring variable reference the syntax #{} so spring will retrieve the value from the variable declared in the file<br/><br/><span style="font-weight:bold;">Step 4 : Adapt your route</span><br/><br/>Define the uri of your route like this :<br/><br/>
    <pre name="code" class="xml"><br/><camel:from ref="fileEndpoint"><br/></pre>
    <br/>Cool isn't !!<br/><br/></camel:from></camel:endpoint></property></property></bean></div>
<h2>Comments</h2>
<div class='comments'>
    <div class='comment'>
        <div class='author'>vfdvgf</div>
        <div class='content'>
            you can get <a href="http://www.power-leveling-game.com/" rel="nofollow">Wow Power Leveling</a> and
            <a href="http://www.pkpay.com" rel="nofollow">wow gold</a> wow power leveling
        </div>
    </div>
    <div class='comment'>
        <div class='author'>Anton Arhipov</div>
        <div class='content'>
            There's a small risk when letting the user to define the backup directory for files:<br/><br/>This:<br/><br/>uriFile=file://d:/temp/data/?move=d:/temp/done/${file.name}<br/><br/>Could easily become this:<br/>uriFile=file://d:/temp/data/?move=d:/temp/data/backup/${file.name}<br/><br/>This way the backup directory for the processed files can be placed into the source directory without dot (".") and therefor cause the recursive scanning of the dirs with the processed files.
        </div>
    </div>
</div>
